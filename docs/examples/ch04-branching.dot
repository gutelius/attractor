// ch04-branching.dot
// Adds a conditional Review node after Implement.
// The diamond shape triggers conditional edge selection based on outcome.

digraph task_manager {
    goal = "Build a task management API"

    Start [shape=Mdiamond label="Start"]

    Plan [
        shape=box
        label="Plan"
        prompt="Create a detailed project plan for: $goal. List the endpoints, data models, and implementation steps."
    ]

    Implement [
        shape=box
        label="Implement"
        prompt="Implement the plan from the previous step for: $goal. Write the Python code with FastAPI endpoints and Pydantic models."
    ]

    // Diamond shape = conditional node.
    // The engine evaluates outgoing edge conditions against this node's outcome.
    Review [shape=diamond label="Review"]

    Revise [
        shape=box
        label="Revise"
        prompt="The review found issues. Revise the implementation to address the feedback."
    ]

    Exit [shape=Msquare label="Exit"]

    Start -> Plan
    Plan -> Implement
    Implement -> Review

    // Conditional edges: the engine picks the edge whose condition matches.
    Review -> Exit [condition="outcome=success" label="pass"]
    Review -> Revise [condition="outcome=fail" label="fail"]
    Revise -> Exit
}
